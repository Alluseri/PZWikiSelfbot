var MD5=function(e){return M(V(Y(X(e),8*e.length))).toLowerCase()};function M(e){for(var t,a="0123456789ABCDEF",i="",n=0;n<e.length;n++)t=e.charCodeAt(n),i+=a.charAt(t>>>4&15)+a.charAt(15&t);return i}function X(e){for(var t=Array(e.length>>2),a=0;a<t.length;a++)t[a]=0;for(a=0;a<8*e.length;a+=8)t[a>>5]|=(255&e.charCodeAt(a/8))<<a%32;return t}function V(e){for(var t="",a=0;a<32*e.length;a+=8)t+=String.fromCharCode(e[a>>5]>>>a%32&255);return t}function Y(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var a=1732584193,i=-271733879,n=-1732584194,o=271733878,d=0;d<e.length;d+=16){var r=a,c=i,s=n,l=o;i=md5_ii(i=md5_ii(i=md5_ii(i=md5_ii(i=md5_hh(i=md5_hh(i=md5_hh(i=md5_hh(i=md5_gg(i=md5_gg(i=md5_gg(i=md5_gg(i=md5_ff(i=md5_ff(i=md5_ff(i=md5_ff(i,n=md5_ff(n,o=md5_ff(o,a=md5_ff(a,i,n,o,e[d+0],7,-680876936),i,n,e[d+1],12,-389564586),a,i,e[d+2],17,606105819),o,a,e[d+3],22,-1044525330),n=md5_ff(n,o=md5_ff(o,a=md5_ff(a,i,n,o,e[d+4],7,-176418897),i,n,e[d+5],12,1200080426),a,i,e[d+6],17,-1473231341),o,a,e[d+7],22,-45705983),n=md5_ff(n,o=md5_ff(o,a=md5_ff(a,i,n,o,e[d+8],7,1770035416),i,n,e[d+9],12,-1958414417),a,i,e[d+10],17,-42063),o,a,e[d+11],22,-1990404162),n=md5_ff(n,o=md5_ff(o,a=md5_ff(a,i,n,o,e[d+12],7,1804603682),i,n,e[d+13],12,-40341101),a,i,e[d+14],17,-1502002290),o,a,e[d+15],22,1236535329),n=md5_gg(n,o=md5_gg(o,a=md5_gg(a,i,n,o,e[d+1],5,-165796510),i,n,e[d+6],9,-1069501632),a,i,e[d+11],14,643717713),o,a,e[d+0],20,-373897302),n=md5_gg(n,o=md5_gg(o,a=md5_gg(a,i,n,o,e[d+5],5,-701558691),i,n,e[d+10],9,38016083),a,i,e[d+15],14,-660478335),o,a,e[d+4],20,-405537848),n=md5_gg(n,o=md5_gg(o,a=md5_gg(a,i,n,o,e[d+9],5,568446438),i,n,e[d+14],9,-1019803690),a,i,e[d+3],14,-187363961),o,a,e[d+8],20,1163531501),n=md5_gg(n,o=md5_gg(o,a=md5_gg(a,i,n,o,e[d+13],5,-1444681467),i,n,e[d+2],9,-51403784),a,i,e[d+7],14,1735328473),o,a,e[d+12],20,-1926607734),n=md5_hh(n,o=md5_hh(o,a=md5_hh(a,i,n,o,e[d+5],4,-378558),i,n,e[d+8],11,-2022574463),a,i,e[d+11],16,1839030562),o,a,e[d+14],23,-35309556),n=md5_hh(n,o=md5_hh(o,a=md5_hh(a,i,n,o,e[d+1],4,-1530992060),i,n,e[d+4],11,1272893353),a,i,e[d+7],16,-155497632),o,a,e[d+10],23,-1094730640),n=md5_hh(n,o=md5_hh(o,a=md5_hh(a,i,n,o,e[d+13],4,681279174),i,n,e[d+0],11,-358537222),a,i,e[d+3],16,-722521979),o,a,e[d+6],23,76029189),n=md5_hh(n,o=md5_hh(o,a=md5_hh(a,i,n,o,e[d+9],4,-640364487),i,n,e[d+12],11,-421815835),a,i,e[d+15],16,530742520),o,a,e[d+2],23,-995338651),n=md5_ii(n,o=md5_ii(o,a=md5_ii(a,i,n,o,e[d+0],6,-198630844),i,n,e[d+7],10,1126891415),a,i,e[d+14],15,-1416354905),o,a,e[d+5],21,-57434055),n=md5_ii(n,o=md5_ii(o,a=md5_ii(a,i,n,o,e[d+12],6,1700485571),i,n,e[d+3],10,-1894986606),a,i,e[d+10],15,-1051523),o,a,e[d+1],21,-2054922799),n=md5_ii(n,o=md5_ii(o,a=md5_ii(a,i,n,o,e[d+8],6,1873313359),i,n,e[d+15],10,-30611744),a,i,e[d+6],15,-1560198380),o,a,e[d+13],21,1309151649),n=md5_ii(n,o=md5_ii(o,a=md5_ii(a,i,n,o,e[d+4],6,-145523070),i,n,e[d+11],10,-1120210379),a,i,e[d+2],15,718787259),o,a,e[d+9],21,-343485551),a=safe_add(a,r),i=safe_add(i,c),n=safe_add(n,s),o=safe_add(o,l)}return Array(a,i,n,o)}function md5_cmn(e,t,a,i,n,o){return safe_add(bit_rol(safe_add(safe_add(t,e),safe_add(i,o)),n),a)}function md5_ff(e,t,a,i,n,o,d){return md5_cmn(t&a|~t&i,e,t,n,o,d)}function md5_gg(e,t,a,i,n,o,d){return md5_cmn(t&i|a&~i,e,t,n,o,d)}function md5_hh(e,t,a,i,n,o,d){return md5_cmn(t^a^i,e,t,n,o,d)}function md5_ii(e,t,a,i,n,o,d){return md5_cmn(a^(t|~i),e,t,n,o,d)}function safe_add(e,t){var a=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(a>>16)<<16|65535&a}function bit_rol(e,t){return e<<t|e>>>32-t}function convertDate(e){function t(e,t){for(;e.length<t;)e="0"+e;return e}return e.getUTCFullYear().toString()+t((e.getUTCMonth()+1).toString(),2)+t(e.getUTCDate().toString(),2)+t(e.getUTCHours().toString(),2)+t(e.getUTCMinutes().toString(),2)+t(e.getUTCSeconds().toString(),2)}function buildHeaders(e,t){return e.cookie=PZWIKI_COOKIE,e["user-agent"]="Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.99 Safari/537.36 OPR/83.0.4254.70",e.accept=t?"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9":"application/json, text/javascript, */*; q=0.01",e["accept-encoding"]="gzip, deflate, br",e["accept-language"]="en-US,en;q=0.9",e.dnt="1",e["sec-ch-ua"]='"Chromium";v="96", "Opera GX";v="83", ";Not A Brand";v="99"',e["sec-ch-ua-mobile"]="?0",e["sec-ch-ua-platform"]="Windows",t?(e["sec-fetch-dest"]="document",e["sec-fetch-mode"]="navigate"):(e["sec-fetch-dest"]="empty",e["sec-fetch-mode"]="cors"),e["sec-fetch-site"]="same-origin",e["sec-fetch-user"]="?1",e["upgrade-insecure-requests"]="1",e}async function getEditData(e){var t=await(await fetch("https://pzwiki.net/wiki/"+e,{method:"GET",credentials:"same-origin",headers:buildHeaders({},!0)})).text();console.log("[STEP/SUCCESS] Pretended to open the wiki article, data will be parsed.");var a=await(await fetch("https://pzwiki.net/w/index.php?title="+e+"&action=edit",{method:"GET",credentials:"same-origin",headers:buildHeaders({referer:"https://pzwiki.net/wiki/"+e},!0)})).text();return console.log("[STEP/SUCCESS] Opened the edit page, data will be parsed."),{date:convertDate(new Date),revisionID:t.match('"wgRevisionId":(.+?),')[1],editingStatsID:a.match('id="editingStatsId" value="(.+?)"')[1],body:a.match(/(?<=<textarea .+? id="wpTextbox1" .+?>).+?(?=<\/textarea>)/gs)[0]}}async function stashEdit(e,t,a,i){var n=await(await fetch("https://pzwiki.net/w/api.php",{method:"POST",credentials:"same-origin",body:Object.entries({action:"stashedit",format:"json",formatversion:"2",title:e,section:"",sectiontitle:"",summary:a,contentmodel:"wikitext",contentformat:"text/x-wiki",baserevid:i.revisionID,text:t,token:PZWIKI_TOKEN}).map((e=>encodeURIComponent(e[0])+"="+encodeURIComponent(e[1]))).join("&"),headers:buildHeaders({referer:"https://pzwiki.net/w/index.php?title="+e+"&action=submit","x-requested-with":"XMLHttpRequest","content-type":"application/x-www-form-urlencoded; charset=UTF-8"},!1)})).json();return n&&n.stashedit&&n.stashedit.texthash?(console.log("[STASH/SUCCESS] Successfully generated a stash hash!"),n.stashedit.texthash):(console.log("[STASH/FAILURE] Failed to generate a stash hash."),-1)}async function publish(e,t,a,i,n){var o=Number.parseInt(i.revisionID),d=new FormData;return d.append("wpUnicodeCheck","‚Ñ≥ùí≤‚ô•ùìäùìÉùíæùí∏‚Ñ¥ùíπ‚ÑØ"),d.append("wpAntispam",""),d.append("editingStatsId",i.editingStatsId),n&&d.append("g-recaptcha-response",n),d.append("wpSection",""),d.append("wpStarttime",i.date),d.append("wpEdittime",convertDate(new Date)),d.append("editRevId",o+2),d.append("wpScrolltop","0"),d.append("wpAutoSummary",MD5(a)),d.append("oldid",0),d.append("parentRevId",o+2),d.append("format","text/x-wiki"),d.append("model","wikitext"),d.append("wpTextbox1",t),d.append("wpSummary",a),d.append("wpWatchthis",""),d.append("wpSave","Save changes"),d.append("wpEditToken",PZWIKI_TOKEN),d.append("mode","text"),d.append("wpUltimateParam","1"),(await(await fetch("https://pzwiki.net/w/index.php?title="+e+"&action=submit",{method:"POST",credentials:"same-origin",body:d,headers:buildHeaders({referer:"https://pzwiki.net/w/index.php?title="+e+"&action=edit","cache-control":"max-age=0"},!0)})).text()).includes("g-recaptcha mw-confirmedit-captcha-fail")}async function fullEditCycle(e,t,a,i){try{console.log("0/3 Pushing edit state");var n=await getEditData(e);console.log("1/3 Taking time"),await new Promise(((o,d)=>setTimeout((async()=>{console.log("2/3 Dropping stash edit"),await stashEdit(e,t,a,n),console.log("3/3 Publishing"),!PZWIKISELFBOT_DISABLE_CAPTCHA&&await publish(e,t,a,n)?(console.log("Check the page."),renderCaptcha(e,t,a,n,o)):(console.log("—Ñ—Ä–µ—à—Ö–∞–∫ –∑–∞–±—É—Å—Ç–∏–ª"),o(!0))}),i)))}catch(e){console.log("—Ñ—Ä–µ—à—Ö–∞–∫ –Ω–µ –∑–∞–±—É—Å—Ç–∏–ª"),console.log(e)}}async function fullEditCycleCallback(e,t,a,i){try{console.log("0/3 Pushing edit state");var n=await getEditData(e);console.log("1/3 Editing existing content and taking time");var o=t(n.body);await new Promise(((t,d)=>setTimeout((async()=>{console.log("2/3 Dropping stash edit"),await stashEdit(e,o,a,n),console.log("3/3 Publishing"),!PZWIKISELFBOT_DISABLE_CAPTCHA&&await publish(e,o,a,n)?(console.log("Check the page."),renderCaptcha(e,o,a,n,t)):(console.log("—Ñ—Ä–µ—à—Ö–∞–∫ –∑–∞–±—É—Å—Ç–∏–ª"),t(!0))}),i)))}catch(e){console.log("—Ñ—Ä–µ—à—Ö–∞–∫ –Ω–µ –∑–∞–±—É—Å—Ç–∏–ª"),console.log(e)}}function renderCaptcha(e,t,a,i,n){document.body.innerHTML='<span style="font-family: Roboto, Arial;"> You tried editing a page with introducing new external links, OR you got suspected in being a bot. Just... complete the captcha.<br>- Nekoseri</span><br>';var o=document.createElement("div");o.id="nekoseri_captcha",o.style="font-family: Roboto, Arial;",o.innerText="Please wait, loading reCAPTCHA...",document.body.appendChild(o),window.bynekoseri_captcha=function(){console.log("Loaded recaptcha framework."),o.innerText="Loaded reCAPTCHA, rendering...",grecaptcha.render("nekoseri_captcha",{callback:async d=>{try{await publish(e,t,a,i,d)?(o.style="font-family: Roboto, Arial;color: red;",o.innerText="You didn't pass the reCAPTCHA check. Please try again."):(o.style="font-family: Roboto, Arial;color: green;",o.innerText="Congratulations, your edit has been published."),console.log("—Ñ—Ä–µ—à—Ö–∞–∫ –∑–∞–±—É—Å—Ç–∏–ª"),n(!0)}catch(e){console.log("—Ñ—Ä–µ—à—Ö–∞–∫ –Ω–µ –∑–∞–±—É—Å—Ç–∏–ª"),console.log(e),o.style="font-family: Roboto, Arial;color: darkred;",o.innerText="There was an error while publishing, check the console...",n(!1)}},sitekey:"6LeBTBcTAAAAAETBveoI74AzxhPZz2-4I5JA0p0B"})};var d=document.createElement("script");d.src="https://www.google.com/recaptcha/api.js?onload=bynekoseri_captcha&render=explicit&hl=en",document.body.appendChild(d)}var PZWIKI_TOKEN=mw.user.tokens.values.editToken,PZWIKI_COOKIE=document.cookie,PZWIKISELFBOT_DISABLE_CAPTCHA=!1;
